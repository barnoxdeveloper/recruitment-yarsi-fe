<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Multi-Step Form</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
        <style>
            fieldset {
                display: none;
            }
            fieldset.active {
                display: block;
            }
        </style>
    </head>
    <body>
        <div class="container mt-5">
            <form id="multi-step-form">
                <!-- Data Pribadi -->
                <fieldset id="personal_information">
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="fs-4">Data Pribadi</h3>
                            <h4 class="fs-5 mb-4 fst-italic">(Personal Information)</h4>
                            <div class="row g-3">
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="first-name-candidate" class="form-label">
                                            Nama Depan <span class="fst-italic">(First Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="first_name"
                                            id="first-name-candidate"
                                            placeholder="Nama Depan (First Name)"
                                            maxlength="100"
                                            required
                                        />
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="last-name-candidate" class="form-label">
                                            Nama Belakang <span class="fst-italic">(Last Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="last_name"
                                            id="last-name-candidate"
                                            placeholder="Nama Belakang (Last Name)"
                                            required
                                            maxlength="100"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset id="family_members">
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="fs-4">Keluarga Yang Bisa Dihubungi Dalam Keadaan Darurat</h3>
                            <h4 class="fs-5 mb-4 fst-italic">(Family Member / Who can be Contacted In an Emergency)</h4>
                            <div class="row g-3">
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="relationship_id" class="form-label"> Hubungan <span class="fst-italic">(Relation)</span>*</label>
                                        <select
                                            class="form-select"
                                            aria-label="relationship_id"
                                            name="relationship_id"
                                            id="relationship-id-emergency-contact-candidates"
                                            required
                                        >
                                            <option value="">Select Hubungan (Relation)</option>
                                            <option value="suami" id="suami">Suami</option>
                                            <option value="istri" id="istri">Istri</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="name-emergency-contact-candidates" class="form-label">
                                            Nama <span class="fst-italic">(Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="name_family_member"
                                            id="name-emergency-contact-candidates"
                                            placeholder="Nama (Name)"
                                            maxlength="100"
                                            required
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mb-5">
                                <button type="button" class="btn btn-success" id="btn-save-emergency-contact">Add Family</button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered" id="table-emergency-contact-candidates">
                                    <thead class="text-center">
                                        <tr>
                                            <th>Hubungan</th>
                                            <th>Nama</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-center"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset id="organization">
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="fs-4">Organisasi</h3>
                            <h4 class="fs-5 mb-4 fst-italic">(Organization)</h4>
                            <div class="row g-3">
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="name-organization" class="form-label"> Name*</label>
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="name_organization"
                                            id="name-organization"
                                            maxlength="100"
                                            required
                                        />
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="last-name-candidate" class="form-label"> Location*</label>
                                        <input type="text" class="form-control" name="location" id="location-organization" maxlength="100" required />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <div class="d-flex justify-content-center mb-5">
                    <div class="navigation-buttons mt-3">
                        <button type="button" class="btn btn-danger prev-step">
                            Previous
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <button type="button" class="btn btn-success next-step">
                            Next
                            <i class="bi bi-arrow-right"></i>
                        </button>
                        <button type="submit" class="btn btn-primary submit-button">
                            Submit
                            <i class="bi bi-send-check"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/store.js/2.0.1/store.legacy.min.js"
            integrity="sha512-XbzqqqogVHe2RPEnKNxzuW+57fuEDGL4O6wdxh/W75oJjbgpwa1KHB4XpUZ2rMT/hhRUI1L1n9hNpMvSJb6DiA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script>
            $(document).ready(function () {
                let currentStep = 0;
                let steps = $("fieldset");
                let $prevButton = $(".prev-step");
                let $nextButton = $(".next-step");
                let $submitButton = $(".submit-button");

                function showStep(step) {
                    steps.removeClass("active");
                    steps.eq(step).addClass("active");

                    $prevButton.toggle(step > 0);
                    $nextButton.toggle(step < steps.length - 1);
                    $submitButton.toggle(step === steps.length - 1);
                }

                function validateStep(step) {
                    let inputs = steps.eq(step).find(":input[required]");
                    let isValid = true;
                    inputs.each(function () {
                        if (!this.checkValidity()) {
                            isValid = false;
                            $(this).addClass("is-invalid");
                        } else {
                            $(this).removeClass("is-invalid");
                        }
                    });
                    return isValid;
                }

                function saveStepData(step) {
                    let fieldsetID = steps.eq(step).attr("id");
                    if (fieldsetID === "family_members") {
                        saveFamilyMembers();
                    } else {
                        let inputs = steps.eq(step).find(":input");
                        let stepData = {};
                        inputs.each(function () {
                            stepData[this.name] = $(this).val();
                        });
                        store.set(fieldsetID, stepData);
                    }
                }

                function loadStepData(step) {
                    let fieldsetID = steps.eq(step).attr("id");
                    let stepData = store.get(fieldsetID);
                    if (stepData) {
                        let inputs = steps.eq(step).find(":input");
                        inputs.each(function () {
                            $(this).val(stepData[this.name]);
                        });
                    }
                }

                // family member start
                function saveFamilyMembers() {
                    let familyMembers = store.get("family_members") || []; // Default to empty array if not set
                    let relationship = $("#relationship-id-emergency-contact-candidates").val();
                    let name = $("#name-emergency-contact-candidates").val();

                    // Check if both relationship and name have values before pushing
                    if (relationship && name) {
                        familyMembers.push({ relationship: relationship, name: name });
                    }

                    store.set("family_members", familyMembers);
                    $("#relationship-id-emergency-contact-candidates").prop("required", false);
                    $("#name-emergency-contact-candidates").prop("required", false);
                    renderFamilyMembersTable();
                }

                function renderFamilyMembersTable() {
                    let familyMembers = store.get("family_members") || [];
                    let $tableBody = $("#table-emergency-contact-candidates tbody");
                    $tableBody.empty();
                    familyMembers.forEach(function (member) {
                        $tableBody.append("<tr><td>" + member.relationship + "</td><td>" + member.name + "</td></tr>");
                    });
                }

                $("#btn-save-emergency-contact").click(function () {
                    if (validateStep(currentStep)) {
                        saveFamilyMembers();
                        $("#relationship-id-emergency-contact-candidates").val("");
                        $("#name-emergency-contact-candidates").val("");
                    }
                });
                // family member end

                $nextButton.click(function () {
                    const currentFieldset = steps.eq(currentStep);
                    const fieldsetID = currentFieldset.attr("id");
                    if (store.get(fieldsetID) !== undefined) {
                        currentStep++;
                        loadStepData(currentStep);
                        showStep(currentStep);
                    } else {
                        if (validateStep(currentStep) && currentStep < steps.length - 1) {
                            saveStepData(currentStep);
                            currentStep++;
                            loadStepData(currentStep);
                            showStep(currentStep);
                        }
                    }
                });

                $prevButton.click(function () {
                    if (currentStep > 0) {
                        currentStep--;
                        loadStepData(currentStep);
                        showStep(currentStep);
                    }
                });

                $("#multi-step-form").submit(function (e) {
                    console.info("clicked");
                    if (!validateStep(currentStep)) {
                        e.preventDefault();
                    } else {
                        saveStepData(currentStep);
                        store.clearAll();
                        alert("Form submitted!");
                    }
                });

                showStep(currentStep);
                loadStepData(currentStep);
                renderFamilyMembersTable();

                function onSubmit(token) {
                    document.getElementById("multi-step-form").submit();
                }
            });
        </script>
    </body>
</html>
