<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Multi-Step Form</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
            crossorigin="anonymous"
        />
        <style>
            fieldset {
                display: none;
            }
            fieldset.active {
                display: block;
            }
        </style>
    </head>
    <body>
        <div class="container mt-5">
            <form id="multi-step-form">
                <!-- Data Pribadi -->
                <fieldset>
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="fs-4">Data Pribadi</h3>
                            <h4 class="fs-5 mb-4 fst-italic">(Personal Information)</h4>
                            <div class="row g-3">
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="first-name-candidate" class="form-label">
                                            Nama Depan <span class="fst-italic">(First Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="first_name"
                                            id="first-name-candidate"
                                            placeholder="Nama Depan (First Name)"
                                            maxlength="100"
                                            required
                                        />
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="last-name-candidate" class="form-label">
                                            Nama Belakang <span class="fst-italic">(Last Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="last_name"
                                            id="last-name-candidate"
                                            placeholder="Nama Belakang (Last Name)"
                                            required
                                            maxlength="100"
                                        />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="fs-4">Keluarga Yang Bisa Dihubungi Dalam Keadaan Darurat</h3>
                            <h4 class="fs-5 mb-4 fst-italic">(Family Member / Who can be Contacted In an Emergency)</h4>
                            <div class="row g-3">
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="relationship_id" class="form-label">
                                            Hubungan <span class="fst-italic">(Relation)</span>*</label
                                        >
                                        <select
                                            class="form-select"
                                            aria-label="relationship_id"
                                            name="relationship_id"
                                            id="relationship-id-emergency-contact-candidates"
                                            required
                                        >
                                            <option value="">Select Hubungan (Relation)</option>
                                            <option value="suami" id="suami">Suami</option>
                                            <option value="istri" id="istri">Istri</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="name" class="form-label">
                                            Nama <span class="fst-italic">(Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="name"
                                            id="name-emergency-contact-candidates"
                                            placeholder="Nama (Name)"
                                            required
                                            maxlength="100"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mb-5">
                                <button type="button" class="btn btn-success" id="btn-save-emergency-contact">
                                    Add Family
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table
                                    class="table table-striped table-bordered"
                                    id="table-emergency-contact-candidates"
                                >
                                    <thead class="text-center">
                                        <tr>
                                            <th>Hubungan</th>
                                            <th>Nama</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-center"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </fieldset>
                <fieldset>
                    <div class="card mb-3">
                        <div class="card-body">
                            <h3 class="fs-4">Data Riwayat Pendidikan</h3>
                            <h4 class="fs-5 mb-4 fst-italic">(Educational Background)</h4>
                            <div class="row g-3">
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="education-id-education-background-candidates" class="form-label"
                                            >Jenjang <span class="fst-italic">(Academic Degree)</span>*</label
                                        >
                                        <select
                                            class="form-select"
                                            aria-label="education-id-education-background-candidates"
                                            name="education_id"
                                            id="education-id-education-background-candidates"
                                            required
                                        >
                                            <option value="">Select Jenjang (Academic Degree)</option>
                                            <option value="1" id="SD">SD</option>
                                            <option value="2" id="SMP">SMP</option>
                                            <option value="3" id="SMA">SMA</option>
                                            <option value="4" id="D3">D3</option>
                                            <option value="4" id="S1">S1</option>
                                            <option value="4" id="S2">S2</option>
                                            <option value="4" id="S3">S3</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6 col-12">
                                    <div class="mb-3">
                                        <label for="institution-name-education-background-candidates" class="form-label"
                                            >Nama Institusi <span class="fst-italic">(Institution Name)</span>*</label
                                        >
                                        <input
                                            type="text"
                                            class="form-control"
                                            name="institution_name"
                                            id="institution-name-education-background-candidates"
                                            placeholder="Institution Name (Institution Name)"
                                            required
                                            maxlength="100"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex justify-content-center mb-5">
                                <button type="button" class="btn btn-success" id="btn-save-education-background">
                                    Add Education
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered" id="table-education-background">
                                    <thead class="text-center">
                                        <tr>
                                            <th>Jenjang</th>
                                            <th>Nama Institusi</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-center"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <div class="d-flex justify-content-center mb-5">
                    <div class="navigation-buttons mt-3">
                        <button type="button" class="btn btn-danger prev-step">
                            Previous
                            <i class="bi bi-arrow-left"></i>
                        </button>
                        <button type="button" class="btn btn-success next-step">
                            Next
                            <i class="bi bi-arrow-right"></i>
                        </button>
                        <button type="submit" class="btn btn-primary submit-button">
                            Submit
                            <i class="bi bi-send-check"></i>
                        </button>
                    </div>
                </div>
            </form>
        </div>

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
            integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"
        ></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/store.js/2.0.1/store.legacy.min.js"
            integrity="sha512-XbzqqqogVHe2RPEnKNxzuW+57fuEDGL4O6wdxh/W75oJjbgpwa1KHB4XpUZ2rMT/hhRUI1L1n9hNpMvSJb6DiA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"
        ></script>
        <script>
            $(document).ready(function () {
                var currentStep = 0;
                var steps = $("fieldset");
                var $prevButton = $(".prev-step");
                var $nextButton = $(".next-step");
                var $submitButton = $(".submit-button");

                function showStep(step) {
                    steps.removeClass("active");
                    steps.eq(step).addClass("active");

                    $prevButton.toggle(step > 0);
                    $nextButton.toggle(step < steps.length - 1);
                    $submitButton.toggle(step === steps.length - 1);
                }

                function validateStep(step) {
                    var inputs = steps.eq(step).find(":input[required]");
                    var isValid = true;
                    inputs.each(function () {
                        if (!this.checkValidity()) {
                            isValid = false;
                            $(this).addClass("is-invalid");
                        } else {
                            $(this).removeClass("is-invalid");
                        }
                    });
                    return isValid;
                }

                function saveStepData(step) {
                    var inputs = steps.eq(step).find(":input");
                    var stepData = {};
                    inputs.each(function () {
                        stepData[this.name] = $(this).val();
                    });
                    store.set("step_" + step, stepData);
                }

                function loadStepData(step) {
                    var stepData = store.get("step_" + step);
                    if (stepData) {
                        var inputs = steps.eq(step).find(":input");
                        inputs.each(function () {
                            $(this).val(stepData[this.name]);
                        });
                    }
                }

                // family member start
                function saveFamilyMembers() {
                    var familyMembers = store.get("family_members") || [];
                    var relationship = $("#relationship-id-emergency-contact-candidates").val();
                    var name = $("#name-emergency-contact-candidates").val();
                    familyMembers.push({ relationship: relationship, name: name });
                    store.set("family_members", familyMembers);
                    renderFamilyMembersTable();
                }
                function renderFamilyMembersTable() {
                    var familyMembers = store.get("family_members") || [];
                    var $tableBody = $("#table-emergency-contact-candidates tbody");
                    $tableBody.empty();
                    familyMembers.forEach(function (member) {
                        $tableBody.append("<tr><td>" + member.relationship + "</td><td>" + member.name + "</td></tr>");
                    });
                }
                $("#btn-save-emergency-contact").click(function () {
                    if (validateStep(currentStep)) {
                        saveFamilyMembers();
                        $("#relationship-id-emergency-contact-candidates").val("");
                        $("#name-emergency-contact-candidates").val("");
                    }
                });
                // family member end

                // education background
                function saveEducationBackground() {
                    var educationBackground = store.get("education_backgrounds") || [];
                    var educationId = $("#education-id-education-background-candidates").val();
                    var institutionName = $("#institution-name-education-background-candidates").val();
                    educationBackground.push({ education_id: educationId, name: institutionName });
                    store.set("education_backgrounds", educationBackground);
                    renderEducationBackgroundTables();
                }
                function renderEducationBackgroundTables() {
                    var educationBackground = store.get("education_backgrounds") || [];
                    var $tableBody = $("#table-education-background tbody");
                    $tableBody.empty();
                    educationBackground.forEach(function (member) {
                        $tableBody.append("<tr><td>" + member.education_id + "</td><td>" + member.name + "</td></tr>");
                    });
                }
                $("#btn-save-education-background").click(function () {
                    if (validateStep(currentStep)) {
                        saveEducationBackground();
                        $("#education-id-education-background-candidates").val("");
                        $("#institution-name-education-background-candidates").val("");
                    }
                });
                // family member end

                $nextButton.click(function () {
                    if (validateStep(currentStep) && currentStep < steps.length - 1) {
                        saveStepData(currentStep);
                        currentStep++;
                        loadStepData(currentStep);
                        showStep(currentStep);
                    }
                });

                $prevButton.click(function () {
                    if (currentStep > 0) {
                        saveStepData(currentStep); // Save current step before moving back
                        currentStep--;
                        loadStepData(currentStep);
                        showStep(currentStep);
                    }
                });

                $("#multi-step-form").submit(function (e) {
                    if (!validateStep(currentStep)) {
                        e.preventDefault();
                    } else {
                        saveStepData(currentStep);
                        alert("Form submitted!");
                    }
                });

                showStep(currentStep);
                loadStepData(currentStep);
                renderFamilyMembersTable();
                renderEducationBackgroundTables();

                function onSubmit(token) {
                    document.getElementById("multi-step-form").submit();
                }
            });
        </script>
    </body>
</html>
